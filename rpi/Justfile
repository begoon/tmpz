set dotenv-load := true
set export := true

default: run-http

preset:
    @echo WIFI_SSID = '"{{ env("WIFI_SSID") }}"' > settings.py
    @echo WIFI_PASSWORD = '"{{ env("WIFI_PASSWORD") }}"' >> settings.py
    @echo WS_HOST = '"{{ env("WS_HOST") }}"' >> settings.py
    @echo WS_PORT = {{ env("WS_PORT") }} >> settings.py
    @echo WS_PATH = '"{{ env("WS_PATH") }}"' >> settings.py

run-http: preset
    uvx mpremote fs cp --force settings.py :
    uvx mpremote run http.py

run-ws: preset reset
    uvx mpremote fs cp settings.py :
    uvx mpremote run ws.py

run-oled: reset
    uvx mpremote fs cp ssd1306.py :
    uvx mpremote run oled.py

packages:
    uv pip install -U micropython-rp2-pico_w-stubs --target typings

reset:
    uvx mpremote soft-reset
